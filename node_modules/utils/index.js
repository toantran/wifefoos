
exports.map = function( array, asyncMapFn, callback ) {
  var counter = array.length;
  var new_array = [];
  
  array.forEach(function (item, index) {
    asyncMapFn(item, function (err, result) {
      if (err) { 
        callback(err); 
        return; 
      };
      
      new_array[index] = result;
      counter--;
      if (counter === 0) {
        callback(null, new_array);
      }
    });
  });
};
