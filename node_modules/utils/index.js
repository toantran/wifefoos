
exports.map = function( array, asyncMapFn, callback ) {
  var counter = array.length
    , new_array = [];
  
  array.forEach(function (item, index) {
    asyncMapFn(item, function (err, result) {
      if (err) { 
        callback(err); 
        return; 
      };
      
      new_array[index] = result;
      counter--;
      if (counter === 0) {
        callback(null, new_array);
      }
    });
  });
};


exports.parallel = function( fnArray, callback) {
  var counter = fnArray.length
    , resultArray = [];
  
  fnArray.forEach( function(fn, index) {
    fn( function(error, result) {      
      if (error) {
        callback(error);
        return;
      }
      
      resultArray[index] = result;
      counter--;
      if (counter === 0) {
        callback(null, resultArray);
      }
    });
  });
}
